"use strict";angular.module("sparkFullStackApp",["ngCookies","ngResource","ngSanitize","ngRoute","btford.socket-io","ui.bootstrap","nvd3ChartDirectives","base64"]).config(["$routeProvider","$locationProvider",function(a,b){a.otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),angular.module("sparkFullStackApp").controller("GraphCtrl",["$scope","$routeParams","$http","$rootScope","$interval",function(a,b,c,d,e){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.sensorId=b.sensorId,a.infoGraph={},a.xAxisTickFormatFunction=function(){return function(a){return a}};var f=function(a,b){var c=Math.pow(10,b),d=Math.round(c*a);return d/c};a.yAxisTickFormatFunction=function(){return function(a){return f(a,5)}},a.sizeAverageData=0;var g=function(b){var c=b.split(",");a.sizeAverageData+=c.length,console.log("Size data: "+c.length);for(var d=0;d<c.length-1;d++)a.sensorData[0].values.push([a.incr,parseInt(c[d])]),a.incr+=5};a.allRepeatStart=[],a.allRepeatEnd=[];var h=function(a,b,c){for(var d=[],e=[],f=a.length,g=b-1,h=c;f>h;h++){if(!(f>b&&a[h][1]==a[b][1])){d.push(c-1),d.push(g),e.push(h-1),e.push(b-1);break}b+=1}return{start:d,end:e}},i=function(b){for(var c=[],d=b.length,e=0;d>e;){if(c.length>0){var f=0;for(var g in c){if(!(c[g]-1<f||0==f))break;var i=h(b,c[g],e);i.end[0]>f&&(f=i.end[0]),i.end[0]-i.start[0]>20&&(a.allRepeatStart.push(i.start),a.allRepeatEnd.push(i.end))}e=f,c=[]}else for(var j=e+1;d>j;j++)b[e][1]==b[j][1]&&c.push(j+1);e++}};a.incr=0,a.cpt=0,a.totalT=0,a.totalT2=0,a.sensorData=[];var j=function(){0==a.sensorData.length&&(a.sensorData=[{key:b.sensorId,values:[]}]),a.start=(new Date).getTime(),c.get("https://api.spark.io/v1/devices/"+b.carteId+"/"+b.sensorId+"?access_token="+d.access_token).success(function(b){a.infoGraph=b;var c=(new Date).getTime();a.cpt+=1,a.totalT+=c-a.start,"string"==typeof b.result?g(b.result):(a.end||(a.incr+=c-a.start),null!=b.result&&a.sensorData[0].values.push([a.incr,b.result]),a.incr+=200);var d=(new Date).getTime();a.totalT2+=d-c,console.log("Time request: ",c-a.start)}).error(function(a){console.log(a)})};a.end=!1;var k=null,l=null;a.readData=function(){console.log(b.typeSensor),"string"!=b.typeSensor?a.stop=e(function(){j()},200):(k=new EventSource("https://api.spark.io/v1/devices/"+b.carteId+"/events/?access_token="+d.access_token),k.addEventListener("open",function(a){console.log("Opened! : ",a)},!1),k.addEventListener("error",function(){console.log("Errored!")},!1),k.addEventListener("allData",function(a){var b=JSON.parse(a.data);if(null==l)l=new Date(b.published_at);else{var c=new Date(b.published_at);console.log("Time published : "+(c-l)),l=c}j()},!1))},a.readData(),a.dataRep=[],a.stopDraw=function(){angular.isDefined(a.stop)?(e.cancel(a.stop),a.stop=void 0):(k.close(),l=null),a.end=!0,i(a.sensorData[0].values),a.dataRep=[],console.log(a.exampleData);for(var b in a.allRepeatStart){for(var c={key:"Sequence"+b,values:[]},d=a.allRepeatStart[b][0];d<a.allRepeatEnd[b][0];d++)c.values.push(a.sensorData[0].values[d]);a.dataRep.push(c),c={key:"Repetition"+b,values:[]};for(var d=a.allRepeatStart[b][1];d<a.allRepeatEnd[b][1];d++)c.values.push(a.sensorData[0].values[d]);a.dataRep.push(c)}console.log(a.dataRep),console.log("Request took : "+a.totalT/a.cpt+"\nWith : "+a.cpt),console.log("Calcul took : "+a.totalT2/a.cpt+"\nWith : "+a.cpt),console.log("Size table took : "+a.sizeAverageData/a.cpt+"\nWith : "+a.cpt)},a.clearData=function(){e.cancel(a.drawData),a.sensorData=[],a.dataRep=[],a.incr=0}}]),angular.module("sparkFullStackApp").config(["$routeProvider",function(a){a.when("/graph/:carteId/:sensorId/:typeSensor",{templateUrl:"app/graph/graph.html",controller:"GraphCtrl"})}]),angular.module("sparkFullStackApp").controller("MainCtrl",["$scope","$rootScope","$base64","$http","socket",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.listCarte={},a.infoConnect={},b.access_token=null;a.connection={client_id:"cli",client_secret:" ",grant_type:"password",username:"thomas.mazurkiewicz.89@gmail.com",password:"t75gi93o6"},b.connection=a.connection;var e="client_id="+b.connection.client_id+"&client_secret="+b.connection.client_secret+"&grant_type="+b.connection.grant_type+"&username="+b.connection.username+"&password="+b.connection.password,f=b.connection.username+":"+b.connection.password;b.arrayToken=[];var g=function(){d({method:"POST",url:"https://api.spark.io/oauth/token",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){b.access_token=a.access_token}).error(function(a){console.log(a)})},h=function(){d.get("https://api.spark.io/v1/devices?access_token="+b.access_token).success(function(c){b.listCarte=c,a.listCarte=c})};d({method:"GET",url:"https://api.spark.io/v1/access_tokens",headers:{Authorization:"Basic "+c.encode(f)}}).success(function(a){if(b.arrayToken=a,b.arrayToken.length>0){var c=new Date;angular.forEach(b.arrayToken,function(a){var d=new Date(a.expires_at);0>d-c?g():null==b.access_token&&(b.access_token=a.token)})}else g();h()}).error(function(a){console.log(a)})}]),angular.module("sparkFullStackApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("sparkFullStackApp").controller("SensorCtrl",["$scope","$rootScope","$http","$location","$routeParams",function(a,b,c,d,e){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.arraySensors=[{name:"infra rouge"},{name:"capteur distance"},{name:"vitesse moteur"}],a.arrayCarte=[{name:"Spark"},{name:"Arduino"}],a.carteId=e.carteId,a.go=function(a,b){d.path(a+b)},a.listCarte=b.listCarte,c.get("https://api.spark.io/v1/devices/"+e.carteId+"?access_token="+b.access_token).success(function(a){b.listDataCarte=a}),a.reponse=null,a.args=[],a.useFunction=function(d,f){c({method:"POST",url:"https://api.spark.io/v1/devices/"+e.carteId+"/"+d+"?access_token="+b.access_token,data:"&args="+a.args[f],headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){a.reponse=b}).error(function(a){console.log(a)})}}]),angular.module("sparkFullStackApp").config(["$routeProvider",function(a){a.when("/sensor/:carteId",{templateUrl:"app/sensor/sensor.html",controller:"SensorCtrl"})}]),angular.module("sparkFullStackApp").controller("TokenCtrl",["$scope","$base64","$rootScope","$http",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var e=c.connection.username+":"+c.connection.password;a.arrayToken={tokens:c.arrayToken,check:{}},a.clearToken=function(f){d({method:"DELETE",url:"https://api.spark.io/v1/access_tokens/"+a.arrayToken.tokens[f].token,headers:{Authorization:"Basic "+b.encode(e)}}).success(function(b){console.log(b),a.arrayToken.check[f.toString()]=!1,c.access_token==a.arrayToken.tokens[f].token&&(c.access_token=null),console.log(a.arrayToken.tokens.length),a.arrayToken.tokens.length<2?(console.log("ici"),a.arrayToken.tokens=[],a.arrayToken.check={}):a.arrayToken.tokens.splice(f,1)}).error(function(a){console.log(a)})},a.clearAllToken=function(){for(var b in a.arrayToken.tokens)a.clearToken(b)},a.idCarte=c.idCarte,a.clearSelectedToken=function(){angular.forEach(a.arrayToken.check,function(b,c){var d=parseInt(c);b&&a.clearToken(d)}),a.arrayToken.check={}}}]),angular.module("sparkFullStackApp").config(["$routeProvider",function(a){a.when("/token",{templateUrl:"app/token/token.html",controller:"TokenCtrl"})}]),angular.module("sparkFullStackApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("sparkFullStackApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("sparkFullStackApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("sparkFullStackApp").run(["$templateCache",function(a){a.put("app/graph/graph.html",'<!DOCTYPE html><html><head lang=en><meta charset=UTF-8><title></title></head><body><span>Sensor is : {{sensorId}}</span><div><button type=button class="btn btn-default" ng-click=readData()>Read</button> <button type=button class="btn btn-default" ng-click=stopDraw()>Stop</button> <button type=button class="btn btn-default" ng-click=clearData()>Clear</button></div><nvd3-line-with-focus-chart data=sensorData id=SensorId margin={left:80,top:50,bottom:30,right:50} width=900 height=500 xaxistickformat=xAxisTickFormatFunction() yaxistickformat=yAxisTickFormatFunction() x2axistickformat=xAxisTickFormatFunction() y2axistickformat=yAxisTickFormatFunction() showxaxis=true showyaxis=true objectequality=true showlegend=true nodata="No Data For You!" interactive=true tooltips=true><svg></svg></nvd3-line-with-focus-chart><nvd3-line-with-focus-chart data=dataRep id=ok margin={left:80,top:50,bottom:30,right:50} width=900 height=500 xaxistickformat=xAxisTickFormatFunction() yaxistickformat=yAxisTickFormatFunction() x2axistickformat=xAxisTickFormatFunction() y2axistickformat=yAxisTickFormatFunction() showxaxis=true showyaxis=true objectequality=true showlegend=true nodata="No Data For You!" interactive=true tooltips=true><svg></svg></nvd3-line-with-focus-chart></body></html>'),a.put("app/main/main.html",'<h1 class=page-header>Dashboard</h1><div class="row placeholders"><div class="col-xs-6 col-sm-3 placeholder"><img data-src=holder.js/200x200/auto/sky class=img-responsive alt="Generic placeholder thumbnail"><h4>Label</h4><span class=text-muted>Something else</span></div><div class="col-xs-6 col-sm-3 placeholder"><img data-src=holder.js/200x200/auto/vine class=img-responsive alt="Generic placeholder thumbnail"><h4>Label</h4><span class=text-muted>Something else</span></div><div class="col-xs-6 col-sm-3 placeholder"><img data-src=holder.js/200x200/auto/sky class=img-responsive alt="Generic placeholder thumbnail"><h4>Label</h4><span class=text-muted>Something else</span></div><div class="col-xs-6 col-sm-3 placeholder"><img data-src=holder.js/200x200/auto/vine class=img-responsive alt="Generic placeholder thumbnail"><h4>Label</h4><span class=text-muted>Something else</span></div></div>User: <a href=/#/token>{{connection.username}}</a><h2 class=sub-header>Electronics boards</h2><div class=table-responsive><table class="table table-striped"><thead><tr><th>Id</th><th>Name</th><th>Last heard</th><th>Connect</th></tr></thead><tbody><tr ng-repeat="carte in listCarte"><td>{{carte.id}}</td><td>{{carte.name}}</td><td>{{carte.last_heard}}</td><td ng-if=carte.connected><i class="fa fa-check"></i></td><td ng-if=!carte.connected><i class="fa fa-times"></i></td></tr></tbody></table></div>'),a.put("app/sensor/sensor.html",'<!DOCTYPE html><html><head lang=en><meta charset=UTF-8><title></title></head><body><div class=btn-group><button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false>{{listCarte[0].name}} <span class=caret></span></button><ul class=dropdown-menu role=menu><li ng-repeat="carte in listCarte"><a href=#/sensors/{{carte.name}}>{{carte.name}}</a></li></ul></div><h2 class=sub-header>Sensors\' List: {{carteId}}</h2><div class=table-responsive><table class="table table-striped"><thead><tr><th>name</th><th>type</th><th>monitor</th></tr></thead><tbody><tr ng-repeat="(key,typeSensor) in listDataCarte.variables"><td>{{key}}</td><td>{{typeSensor}}</td><td><button type=button class="btn btn-default" ng-click="go(\'/graph/\',carteId + \'/\' + key + \'/\' + typeSensor)">show</button></td></tr></tbody></table></div><h2 class=sub-header>Functions\' List: {{carteId}}</h2><div class=table-responsive><table class="table table-striped"><thead><tr><th>Name</th><th>Args</th><th></th><th>Output</th></tr></thead><tbody><tr ng-repeat="funcName in listDataCarte.functions track by $index"><td>{{funcName}}</td><td><input ng-model=args[$index] required></td><td><button type=button class="btn btn-default" ng-click=useFunction(funcName,$index)>Send</button></td><td>{{reponse.return_value}}</td></tr></tbody></table></div></body></html>'),a.put("app/token/token.html",'<!DOCTYPE html><html><head lang=en><meta charset=UTF-8><title></title></head><body><button type=button class="btn btn-default" ng-click=clearSelectedToken()>ClearTokens</button> <button type=button class="btn btn-default" ng-click=clearAllToken()>ClearAll</button><h2 class=sub-header>{{arrayToken.tokens.length}} Tokens</h2><div class=table-responsive><table class="table table-striped"><thead><tr><th>Token</th><th>Expires_at</th><th>Client</th><th>Check</th><th>Clear</th></tr></thead><tbody><tr ng-repeat="token in arrayToken.tokens track by $index"><td>{{token.token}}</td><td>{{token.expires_at}}</td><td>{{token.client}}</td><td><input type=checkbox ng-click=check() ng-check=arrayToken.check[$index] ng-model=arrayToken.check[$index]></td><td><button type=button class="btn btn-default" ng-click=clearToken($index)>Clear</button></td></tr></tbody></table></div></body></html>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>spark-full-stack</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);